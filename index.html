<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Jump by MaurGi</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/MaurGi/JUMP">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/MaurGi/JUMP/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/MaurGi/JUMP/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Jump</h1>
          <p>Just Unity Multiplayer with Photon</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/MaurGi">MaurGi</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a id="jump-just-unity-multiplayer-with-photon" class="anchor" href="#jump-just-unity-multiplayer-with-photon" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JUMP (Just Unity Multiplayer with Photon)</h1>

<p><strong>JUMP</strong> is a library that facilitates writing <strong>simple multiplayer games</strong> using <strong><a href="http://unity3d.com/unity">Unity 3D</a></strong> 
and <strong><a href="http://www.photonengine.com/PUN">Photon Unity Networking</a></strong>.</p>

<p>I was working on a multiplayer game and found myself in trouble trying to handle events from 
Unity and Photon at the same time; ending up with fragile code - so I worked to 
streamline and simplify the scenario and build a reusable library.</p>

<p>Out of the box, <strong>JUMP</strong> Provides:</p>

<ul>
<li>A simple flow for connecting to the server, matchmaking and starting a multiplayer game</li>
<li>Authoritative local Server (using Photon Master Client)</li>
<li>Streamlined Client-Server communication</li>
<li>Custom Client Commands and Server Snapshots</li>
<li>Sample Project and Prefabs to get started in 5 minutes</li>
<li>Full source code access and great customization.</li>
</ul>

<h4>
<a id="current-version" class="anchor" href="#current-version" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Current Version</h4>

<p>[0.1.2] - 2016-05-05</p>

<p>For details, see <a href="https://raw.githubusercontent.com/MaurGi/JUMP/master/CHANGELOG.md">Changelog</a></p>

<h4>
<a id="table-of-content" class="anchor" href="#table-of-content" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table of Content</h4>

<ul>
<li><strong><a href="#how-to-install">How To Install</a></strong></li>
<li><strong><a href="#scenario">Scenario</a></strong></li>
<li><strong><a href="#object-model">Object Model</a></strong></li>
<li><strong><a href="#diceroller-sample">DiceRoller Sample</a></strong></li>
<li><strong><a href="#testing-jump">Testing JUMP</a></strong></li>
<li><strong><a href="#features-to-add">Features to Add</a></strong></li>
<li><strong><a href="#license">License</a></strong></li>
</ul>

<h1>
<a id="how-to-install" class="anchor" href="#how-to-install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How to Install</h1>

<p>You can get the source code here or download <strong>JUMP</strong> from the <a href="http://u3d.as/sQw">Unity Asset Store</a>.</p>

<h4>
<a id="prerequisites" class="anchor" href="#prerequisites" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prerequisites</h4>

<p><strong>JUMP</strong> works with <a href="https://unity3d.com/5">Unity 5</a> and requires <a href="https://www.assetstore.unity3d.com/en/#!/content/1786">Photon PUN</a> to function properly:</p>

<ol>
<li>Install <a href="https://www.assetstore.unity3d.com/en/#!/content/1786">Photon PUN Free</a> or <a href="https://www.assetstore.unity3d.com/en/#!/content/12080">Photon PUN+</a>
</li>
<li>Configure your Photon Application ID - see <a href="https://doc.photonengine.com/en/pun/current/getting-started/initial-setup">Initial Setup</a>
</li>
</ol>

<p>For more information about configuring PUN, see <a href="https://doc.photonengine.com/en/pun/current/getting-started/initial-setup">PUN Setup</a>.</p>

<blockquote>
<p>Note: JUMP was tested with Unity version 5.3.4 and Photon PUN Free version 1.67</p>
</blockquote>

<h4>
<a id="option-1-unity-asset-store" class="anchor" href="#option-1-unity-asset-store" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Option 1: Unity Asset Store</h4>

<p>The <a href="http://u3d.as/sQw">Unity Asset Store</a> package includes the <a href="#diceroller-sample">DiceRoller</a> sample project.</p>

<ul>
<li>Download <strong>JUMP</strong> from the <a href="http://u3d.as/sQw">Unity Asset Store</a>.</li>
<li>Add all the scenes in the <code>DiceRollerSample/</code> to the Unity build</li>
<li>Open the <code>DiceRollerConnection</code> scene and start Unity.</li>
<li>The DiceRoller sample should go to the Matchmake scene in connected mode.</li>
</ul>

<blockquote>
<p>Note: To test multiplayer games in Unity, you will need to run two copies of the game, so that they can connect to each other. The best way, is to build a copy of the game (File/Build &amp; Run) for one player and start Unity debugging for the second player. See this Unity <a href="http://answers.unity3d.com/questions/214802/how-to-test-your-multiplayer-game.html">forum post</a> for more details.</p>
</blockquote>

<h4>
<a id="option-2-from-github-source-code" class="anchor" href="#option-2-from-github-source-code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Option 2: From GitHub source code</h4>

<p>In alternative to use the Asset store, you can create a folder in the unity project (under Assets) and copy all the files from the <code>JUMP Multiplayer\</code> folder.
Then you can use the <a href="#object-model">Object Model</a> and the prefabs.</p>

<h1>
<a id="scenario" class="anchor" href="#scenario" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Scenario</h1>

<p>The scenario supported by JUMP is very simple and designed with mobile multiplayer games in mind:</p>

<ul>
<li><a href="#two-players-networking">Two Players networking</a></li>
<li><a href="#basic-matchmaking">Basic matchmaking</a></li>
<li><a href="#streamlined-ui-flow">Streamlined UI flow</a></li>
<li><a href="#custom-server">Custom server</a></li>
<li><a href="#client-server-communication">Client-Server communication</a></li>
</ul>

<h4>
<a id="two-players-networking" class="anchor" href="#two-players-networking" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Two Players networking</h4>

<p>JUMP automates building [Photon] rooms with two players, easy.</p>

<p><em>Note:</em> While it can be extended to support more than two players, the support for UI flow is only for the two players scenario</p>

<h4>
<a id="basic-matchmaking" class="anchor" href="#basic-matchmaking" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Basic Matchmaking</h4>

<p>JUMP supports a single <a href="http://doc.photonengine.com/en/realtime/current/reference/matchmaking-and-lobby">Photon Lobby</a> with <a href="https://doc.photonengine.com/en/realtime/current/reference/matchmaking-and-lobby">Random Matchmaking</a>.</p>

<h4>
<a id="streamlined-ui-flow" class="anchor" href="#streamlined-ui-flow" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Streamlined UI flow</h4>

<p>JUMP supports up to five different Unity scenes:</p>

<ul>
<li>Connection</li>
<li>Home Page (Master)</li>
<li>Matchmaking Lobby</li>
<li>[Room] Waiting for players</li>
<li>[Room] Playing the game</li>
</ul>

<p><em>Note:</em> support for multiple levels can be added to the Playing the game scene. </p>

<p><img src="https://raw.githubusercontent.com/MaurGi/JUMP/master/Doc/UIFlow.png" alt=""></p>

<h4>
<a id="custom-server" class="anchor" href="#custom-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom Server</h4>

<p>JUMP cannot provide a dedicated remote server using <a href="http://www.photonengine.com/PUN">Photon Unity Networking</a> or <a href="http://www.photonengine.com/en-US/Realtime">Photon Cloud</a>, so it uses the <strong>Host</strong> model, where one of the clients also hosts the Game Server (sometimes called <strong>Local Server</strong>) </p>

<p>Photon provides support for this with the concept of <a href="http://doc.photonengine.com/en/pun/current/tutorials/tutorial-marco-polo">Master Client</a>.</p>

<h4>
<a id="client-server-communication" class="anchor" href="#client-server-communication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Client-Server Communication</h4>

<p>JUMP supports the concept of an Authoritative or Semi-Authoritative server using a Command/Snapshot Client-Server communication:</p>

<ul>
<li>The Client sends Commands to the Server</li>
<li>The Server sends Snapshot to the Client</li>
</ul>

<p>The model is similar to the one explained by <a href="http://www.gabrielgambetta.com/fpm1.html">Fast Paced Multiplayer</a>, but we use the term <strong>Command</strong> instead of Actions and <strong>Snapshot</strong> instad of New State</p>

<p><img src="https://raw.githubusercontent.com/MaurGi/JUMP/master/Doc/ClientServer.png" alt=""></p>

<blockquote>
<p>The slanted lines indicate that there is lag between the client and server communication, see <a href="http://schedule.gdconf.com/session/fighting-latency-on-call-of-duty-black-ops-iii">Fighting Latency on Call of Duty III</a></p>
</blockquote>

<p>While it is possible to optimize the client/server communication in terms of reliability and space utilized with delta compression of snapshots and queues of commands, JUMP simply uses 
<a href="https://doc.photonengine.com/en/onpremise/current/getting-started/photon-server-intro">Photon Reliable UDP</a> to communicate, it is a good balance of reliability and ease-of-use.</p>

<h4>
<a id="references" class="anchor" href="#references" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>References</h4>

<p>JUMP Multiplayer with (Semi)Authoritative Server model is based on lots of literature on multiplayer games:</p>

<ul>
<li>
<a href="http://www.gabrielgambetta.com/fpm1.html">Fast Paced Multiplayer</a>  (Gambetta)</li>
<li>
<a href="http://gafferongames.com/networking-for-game-programmers/what-every-programmer-needs-to-know-about-game-networking/">What every programmer needs to know about game networking</a> (Gaffer on Games)</li>
<li>
<a href="http://schedule.gdconf.com/session/fighting-latency-on-call-of-duty-black-ops-iii">Fighting Latency on Call of Duty Black Ops III</a>  (GDC 2016)</li>
<li><a href="http://gamedevelopment.tutsplus.com/tutorials/building-a-peer-to-peer-multiplayer-networked-game--gamedev-10074">Building a Peer-to-Peer Multiplayer Networked Game</a></li>
<li><a href="http://www.pepwuper.com/unity3d-multiplayer-game-development-unity-networking-photon-and-ulink-comparison/">Unity3D Multiplayer Game Development</a></li>
<li><a href="http://gamedev.stackexchange.com/questions/3887/how-can-i-make-a-peer-to-peer-multiplayer-game/3891#3891">How can I make a peer-to-peer multiplayer game?</a></li>
<li><a href="http://docs.unity3d.com/Manual/UNetConcepts.html">Unity Networking</a></li>
</ul>

<h1>
<a id="object-model" class="anchor" href="#object-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Object Model</h1>

<p>JUMP Uses the following classes:</p>

<ul>
<li><a href="#jumpmultiplayer"><code>JUMPMultiplayer</code></a></li>
<li><a href="#jumpgameclient"><code>JUMPGameClient</code></a></li>
<li><a href="#jumpgameserver"><code>JUMPGameServer</code></a></li>
<li><a href="#ijumpgameserverengine"><code>IJUMPGameServerEngine</code></a></li>
<li><a href="#jumpcommand"><code>JUMPCommand</code></a></li>
<li><a href="#jumpcommand_snapshot"><code>JUMPCommand_Snapshot</code></a></li>
<li><a href="#jumpplayer"><code>JUMPPlayer</code></a></li>
<li><a href="#jumpoptions"><code>JUMPOptions</code></a></li>
</ul>

<h4>
<a id="jumpmultiplayer" class="anchor" href="#jumpmultiplayer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JUMPMultiplayer</h4>

<p><code>JUMPMultiplayer</code> is the main class in <strong>JUMP</strong>, handling the connection to the server, the matchmaking, setting up the game room and managing the game client and server. 
<code>JUMPMultiplayer</code> inherits from <a href="http://doc-api.exitgames.com/en/pun/current/class_photon_1_1_pun_behaviour.html"><code>Photon.PunBehaviour</code></a>, which in turn extends <code>UnityEngine.MonoBehaviour</code> to interact both with Photon Networking and Unity Scenes.</p>

<p>To use <code>JUMPMultiplayer</code>, you place it on a Unity Scene, set the <code>Stage</code> property and handle the UnityEvents that are raised by loading other scenes and setting a different Stage or issuing commands. See <a href="#diceroller-sample">DiceRoller Sample</a> for an example.</p>

<p>To facilitate development, <strong>JUMP</strong> provides a series of <strong>JUMPMultiplayer Prefabs</strong> see details <a href="#jumpmultplayer-prefabs">here</a> </p>

<h5>
<a id="jumpmultiplayerstage" class="anchor" href="#jumpmultiplayerstage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>JUMPMultiplayer.Stage</code>
</h5>

<p><code>JUMPMultiplayer</code> works in stages, one for each of the <a href="#streamlined-ui-flow">Steamlined UI flow</a></p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">enum</span> <span class="pl-en">Stages</span>
{
    Connection,
    Master,
    MatchmakeLobby,
    GameRoom,
    Play
}</pre></div>

<p>At high level the <code>Stages</code> state diagram is the following:</p>

<p><img src="https://raw.githubusercontent.com/MaurGi/JUMP/master/Doc/StateDiagram.png" alt=""></p>

<p>In more detail, based on the current stage, <code>JUMPMultiplayer</code> provides the following events and operations:</p>

<h5>
<a id="stagesconnection" class="anchor" href="#stagesconnection" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>Stages.Connection</code>
</h5>

<p>In the <code>Connection</code> stage, JUMP will try to connect to Photon Server, using the <a href="https://doc-api.photonengine.com/en/pun/current/class_photon_network.html#a0fdb79bcce45801ec81fbe56ffb939ec">Photon connection settings</a>:</p>

<p>When the connection is established, the <code>OnMasterConnnect</code> event is raised:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> UnityEvent OnMasterConnect;</pre></div>

<p>You respond to the event by loading a different Unity Scene with a <code>JUMPMultiplayer</code> object set in to the <code>Master</code> stage.
Note that if the connection fails, then the <code>OnMasterConnect</code> event is raised, but the <code>JUMPMultiplayer.IsOffline</code> property is set to true.</p>

<h5>
<a id="stagesmaster" class="anchor" href="#stagesmaster" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>Stages.Master</code>
</h5>

<p>The <code>Master</code> stage is the main screen one, the user is connected to Photon, but not yet into a matchmaking queue or in a game room.
While connected to the Photon Master server (but not in a Lobby or Room), the <code>JUMPMultiplayer.IsConnectedToMaster</code> property will be set to <code>true</code>.</p>

<p>To start the matchmaking proces, you call the <code>Matchmake</code> operation:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">void</span> Matchmake()</pre></div>

<p>This triggers the request to connect to the default <a href="https://doc.photonengine.com/en/realtime/current/reference/matchmaking-and-lobby">Photon Matchmaking Lobby</a> for your game.</p>

<p>When the connection succees, the <code>OnMatchmakeLobbyConnect</code> event is fired. You want to handle this event by loading the Mathcmaking scene.</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> UnityEvent OnMatchmakeLobbyConnect;</pre></div>

<p>If the connection fails or we lose connection to the PhotonServer, then the <code>OnMasterDisconnect</code> event is fired. You want to handle this event by going back to the 'Connection' scene to try and reconnect once - if reconnection fails, you will be navigate again to the main scree with the <code>IsOffline</code> property set to true - in which case, you want to tell your users that they are offline. </p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> UnityEvent OnMasterDisconnect;</pre></div>

<h5>
<a id="stagesmatchmakelobby" class="anchor" href="#stagesmatchmakelobby" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>Stages.MatchmakeLobby</code>
</h5>

<p>In the Matchmake lobby, JUMP will try to matchmake to a <a href="https://doc.photonengine.com/en/realtime/current/reference/matchmaking-and-lobby">Photon Game Room</a> using Randon matchmaking.
While connected to the Photon Lobby, the <code>JUMPMultiplayer.IsConnectedToMatchmakeLobby</code> property will be set to <code>true</code>.</p>

<p>You can cancel the attempt to matchmake by calling the <code>CancelMatchmake</code> operation:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">void</span> CancelMatchmake()</pre></div>

<p>This will cancel the request to matchmake and raise the <code>OnMatchmakeLobbyDisconnect</code> event:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> UnityEvent OnMatchmakeLobbyDisconnect;</pre></div>

<p>The <code>OnMatchmakeLobbyDisconnect</code> is also triggered in case of loss of connection to Photon.
You want to handle this event by going back to the Main screen (<a href="#stagesmaster"><code>Stages.Master</code></a>)</p>

<p>When a game room is found then the <code>OnGameRoomConnect</code> event is fired:</p>

<pre lang="c#''"><code>public UnityEvent OnGameRoomConnect;
</code></pre>

<p>If no room is not found, then one is created and the user is joined to it waiting for other players. The same <code>OnGameRoomConnect</code> event is fired.
You want to handle this even by loading a scene that tells the users they are waiting for the other player to connect.</p>

<p>When the client connects to the Game Room, an instance of the <a href="#jumpgameserver"><code>JUMPGameServer</code></a> is created - this will invoke your custom Server Engine. Just implement the <a href="#ijumpgameserverengine"><code>IJUMPGameServerEngine</code></a> interface in your class and provide the name of the class (including the namespace) to the <code>GameServerEngineTypeName</code> property:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">string</span> GameServerEngineTypeName;</pre></div>

<h5>
<a id="stagesgameroom" class="anchor" href="#stagesgameroom" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>Stages.GameRoom</code>
</h5>

<p>In this stage, the player is connected to a <a href="https://doc.photonengine.com/en/realtime/current/reference/matchmaking-and-lobby">Photon Game Room</a> and waiting for the room to be full with two players.
While connected to the Game Room, the <code>JUMPMultiplayer.IsConnectedToGameRoom</code> property will be set to <code>true</code>.</p>

<p>You can cancel the action and get out of the Game Room, by calling the <code>CancelGameRoom</code> operation:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">void</span> CancelGameRoom()</pre></div>

<p>This will cancel the Game Room request and raise the <code>OnGameRoomDisconnect</code> event:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> UnityEvent OnGameRoomDisconnect;</pre></div>

<p>The <code>OnGameRoomDisconnect</code> event is also triggered if you lose connection to Photon. You want to handle this event by going back to the Main screen (<a href="#stagesmaster"><code>Stages.Master</code></a>).</p>

<p>When the second player connects, then the <code>OnPlayConnect</code> event is fired:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> UnityEvent OnPlayConnect;</pre></div>

<p>The <code>OnPlayConnect</code> event is also fired if the room is already present and you are joining as the second player; in this case you will not have the time to cancel the game room request.
You want to handle the <code>OnPlayConnect</code> event by going to the Game Play scene.</p>

<h5>
<a id="stagesplay" class="anchor" href="#stagesplay" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>Stages.Play</code>
</h5>

<p>This is the stage where the play happens, both players are joined to a Photon Game Room and exchanging commands and snapshots with the server to play the game. While in the Play stage, the <code>JUMPMultiplayer.IsPlayingGame</code> variable is set to true; note that this is a combination of both the <code>IsConnectedToGameRoom</code> and <code>IsRoomFull</code> properties.</p>

<p>You can cancel the game and get out of the room by calling <code>QuitPlay</code>:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">void</span> QuitPlay()</pre></div>

<p>This will exit the game room and trigger the <code>OnPlayDisconnected</code> event:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> UnityEvent OnPlayDisconnected;</pre></div>

<p>The <code>OnPlayDisconnected</code> event is also fired if the other player leaves the room or if you lose connection to Photon.
You want to handle the <code>OnPlayDisconnected</code> event by telling the user the reason for the disconnection (using the <code>QuitGameReason</code> property) and then moving back to the Main screen (<a href="#stagesmaster"><code>Stages.Master</code></a>).</p>

<p>When <code>JUMPMulyiplayer</code> enters in the Play stage, then the <a href="#jumpgameclient"><code>JUMPGameClient</code></a> is initialized. At this point the client connects to the <a href="#jumpgameserver"><code>JUMPGameServer</code></a> that in turn starts sending <strong>Snapshots</strong> to the client.
The <code>JUMPMultiplayer</code> will raise an <code>OnSnapshotReceived</code> event every time an snapshot is sent from the server to the client.
For more information on how to handle the Snapshots, see the <a href="#jumpgameserver"><code>JUMPGameServer</code></a> section.</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> JUMPSnapshotReceivedUnityEvent OnSnapshotReceived;</pre></div>

<h5>
<a id="jumpmultiplayerplayerid" class="anchor" href="#jumpmultiplayerplayerid" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>JUMPMultiplayer.PlayerID</code>
</h5>

<p>Provides the ID of the Photon player object (or -1 if you are not connected to Photon).</p>

<h4>
<a id="jumpmultplayer-prefabs" class="anchor" href="#jumpmultplayer-prefabs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JUMPMultplayer Prefabs</h4>

<p>The <em>/JUMP/Multiplayer</em> folder contains five prefabs, one for each of the <a href="#jumpmultiplayerstage">Stages</a>.
The prefabs are:</p>

<ul>
<li>JUMPMultiplayerConnection</li>
<li>JUMPMultiplayerMaster</li>
<li>JUMPMultiplayerMatchmakeLobby</li>
<li>JUMPMultiplayerGameRoom</li>
<li>JUMPMultiplayerPlay</li>
</ul>

<p>The prefabs are simply a Game Object with a <code>JUMPMultiplayer</code> component set to the relative <code>Stage</code>. The idea is to place these in each of the five scenes that will compose the <a href="#streamlined-ui-flow">UI Flow</a></p>

<h4>
<a id="jumpgameclient" class="anchor" href="#jumpgameclient" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JUMPGameClient</h4>

<p><code>JUMPGameClient</code> uses the singleton pattern, to access it, use the <code>Singleton&lt;JUMPGameClient&gt;.Instance</code> property.</p>

<p>You use the <code>JUMPGameClient</code> to send commands to the server; to do so, just use the <code>SendCommandToServer</code> operation. To define your own commands, see <a href="#jumpcommand"><code>JUMPCommand</code></a>.</p>

<div class="highlight highlight-source-cs"><pre>Singleton&lt;JUMPGameClient&gt;.Instance.SendCommandToServer(<span class="pl-k">new</span> myCommand());</pre></div>

<p>The <code>ConnectToServer</code> operation and <code>OnSnapshotReceived</code> event are used internally by <code>JUMPMultiplayer</code>, you don't need to worry about them :)</p>

<h4>
<a id="jumpgameserver" class="anchor" href="#jumpgameserver" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JUMPGameServer</h4>

<p>The <code>JUMPGameServer</code> is managed by the <code>JUMPMultiplayer</code> class, you don't interact with it directly.
<code>JUMPMultiplayer</code> uses a singleton <code>JUMPGameServer</code> insance to start the game, process client commands and send snapshots to the client.</p>

<p>The <code>JUMPGameServer</code> will send a numbe of snapshots to the client per second that can be customized setting the <code>JUMPOptions.SnapshotsPerSec</code> property, the default is 3 snapshots per second.</p>

<p>The <code>JUMPGameServer</code> is designed to interact with your custom Server Engine - just implement the <a href="#ijumpgameserverengine"><code>IJUMPGameServerEngine</code></a> interface and set the <code>GameServerEngineTypeName</code> property of a <code>JUMPMultiplayer</code> instance with Stage <a href="#stagesmatchmakelobby"><code>Stages.MatchmakeLobby</code></a> (or a <em>JUMPMultiplayerMatchmakeLobby</em> prefab).</p>

<h4>
<a id="ijumpgameserverengine" class="anchor" href="#ijumpgameserverengine" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>IJUMPGameServerEngine</h4>

<p>The <code>IJUMPGameServerEngine</code> interface allows you to customize the Server Engine for your multiplayer game.
An instance of your Server Engine will be hosted by the <a href="http://doc.photonengine.com/en/pun/current/tutorials/tutorial-marco-polo">Master Client</a>, all the communication between client and server is being taken care of by <strong>JUMP</strong>, you can focus on implementing your game logic.</p>

<p>Here is the <code>IJUMPGameServerEngine</code> interface:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">IJUMPGameServerEngine</span>
{
    <span class="pl-k">void</span> <span class="pl-en">StartGame</span>(List&lt;JUMPPlayer&gt; Players);
    <span class="pl-k">void</span> <span class="pl-en">Tick</span>(<span class="pl-k">double</span> <span class="pl-smi">ElapsedSeconds</span>);
    <span class="pl-k">void</span> <span class="pl-en">ProcessCommand</span>(<span class="pl-k">JUMPCommand</span> <span class="pl-smi">command</span>);
    JUMPCommand <span class="pl-en">CommandFromEvent</span>(<span class="pl-k">byte</span> <span class="pl-smi">eventCode</span>, <span class="pl-k">object</span> <span class="pl-smi">content</span>);
    JUMPCommand_Snapshot <span class="pl-en">TakeSnapshot</span>(<span class="pl-k">int</span> <span class="pl-smi">ForPlayerID</span>);
}</pre></div>

<h6>
<a id="void-startgamelistjumpplayer-players" class="anchor" href="#void-startgamelistjumpplayer-players" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>void StartGame(List&lt;JUMPPlayer&gt; Players)</code>
</h6>

<p><strong>JUMP</strong> will call StartGame when the <code>JUMPMultiplayer</code> is in the <code>MatchmakeLobby</code> stage and the player joins (or creates) a Room, right before calling <code>OnGameRoomConnect</code>.
In this operation, you want to initialize your game state, using the information on the <code>Players</code> list to save the list of players that are in the game.</p>

<p>For example, the <a href="#diceroller-customs-erver">DiceRoller Custom Server</a> intializes its own GameState and saves the players using a custom DiceRollerPlayer class.</p>

<h6>
<a id="void-tickdouble-elapsedseconds" class="anchor" href="#void-tickdouble-elapsedseconds" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>void Tick(double ElapsedSeconds)</code>
</h6>

<p>On the Master Server, <code>JUMPGameServer</code> calls <code>Tick</code> every frame update to make your game progress forward.
Do anything time related in this operation; don't bother sending Snapshots, this is automated for you with the <code>TakeSnapshot</code> operation.</p>

<p>For example, the <a href="#diceroller-customs-erver">DiceRoller Custom Server</a> counts down its 30 seconds timeout for the game, after that the game is over.</p>

<h6>
<a id="void-processcommandjumpcommand-command" class="anchor" href="#void-processcommandjumpcommand-command" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>void ProcessCommand(JUMPCommand command)</code>
</h6>

<p>This is where you process your custom commands that the client sends.</p>

<p>See <a href="#jumpcommand">JUMPCommand</a> for how to define your own commands and the <a href="#diceroller-customs-erver">DiceRoller Custom Server</a> for an example of definition and use of a custom command.</p>

<h6>
<a id="jumpcommand-commandfromeventbyte-eventcode-object-content" class="anchor" href="#jumpcommand-commandfromeventbyte-eventcode-object-content" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>JUMPCommand CommandFromEvent(byte eventCode, object content)</code>
</h6>

<p><code>JUMPGameServer</code> needs a way to find out if the Photon Event that it just received from the client comes from your Game Client and carries your custom command, in order to do so, you can implement the <code>CommandFromEvent</code> function, checking if the <code>eventCode</code> is one of your custom operations' one.</p>

<p>See, the <a href="#diceroller-customs-erver">DiceRoller Sample</a> for an example on how to write this function.</p>

<h6>
<a id="jumpcommand_snapshot-takesnapshotint-forplayerid" class="anchor" href="#jumpcommand_snapshot-takesnapshotint-forplayerid" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>JUMPCommand_Snapshot TakeSnapshot(int ForPlayerID)</code>
</h6>

<p><code>JUMPGameServer</code> will send Snapshots automatically to your clients; the <code>TakeSnapshot</code> function is where you can customize the Snapshot.</p>

<p>See, the <a href="#diceroller-customs-erver">DiceRoller Custom Server</a> for an example on how to write this function.</p>

<h4>
<a id="jumpcommand" class="anchor" href="#jumpcommand" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JUMPCommand</h4>

<p><code>JUMPCommand</code> is a base class that allows <strong>JUMP</strong> to define commands and to send them and receive them using the Photon Events system. You can define your own custom commands with little coding.</p>

<p><code>JUMPCommand</code> uses the <code>CommandEventCode</code> property as Photon Event Code, this is a byte variable, in your game you can use any value from <code>0</code> to <code>189</code>.
The <code>CommandData</code> is an object array used to store and retrieve the data for your command, and that can be easily serialized with Photon messages. Only basic types are allowed as Command properties to store in <code>CommandData</code>, for more background information, see Serialization In Photon</p>

<p>Custom <code>JUMPCommand</code>s typically need two constructors, one used for reconstruction of the Command when received from Photon, and one used to initialize the CommandData before sending it to the server.</p>

<p><code>JUMPMultiplayer</code> uses <code>JUMPCommand_Connect</code> as a custom command used to connect the <code>GameClient</code>:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">JUMPCommand_Connect</span> : <span class="pl-k">JUMPCommand</span>
{
    <span class="pl-k">public</span> <span class="pl-k">const</span> <span class="pl-k">byte</span> JUMPCommand_Connect_EventCode = <span class="pl-c1">191</span>;

    <span class="pl-k">public</span> <span class="pl-k">int</span> PlayerID { get { <span class="pl-en">return</span> (int)CommandData[0]; } <span class="pl-k">set</span> { CommandData[<span class="pl-c1">0</span>] = <span class="pl-k">value</span>; } }

    <span class="pl-k">public</span> JUMPCommand_Connect(<span class="pl-k">int</span> playerID) : <span class="pl-c1">base</span>(<span class="pl-k">new</span> <span class="pl-k">object</span>[<span class="pl-c1">1</span>], JUMPCommand_Connect_EventCode)
    {
        PlayerID = playerID;
    }

    <span class="pl-k">public</span> JUMPCommand_Connect(<span class="pl-k">object</span>[] data) : <span class="pl-c1">base</span>(data, JUMPCommand_Connect_EventCode)
    {
    }
}</pre></div>

<p>See, the [DiceRoller Custom Server] for other examples on wiritng your own custom Commands.</p>

<h4>
<a id="jumpcommand_snapshot" class="anchor" href="#jumpcommand_snapshot" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JUMPCommand_Snapshot</h4>

<p>Then the <code>JUMPGameServer</code> sends <code>JUMPCommand_Snapshot</code> periodically to the client.
<code>JUMPCommand_Snapshot</code> is a <code>JUMPCommand</code> that has two property already set: the <code>JUMPSnapshot_EventCode</code> and the <code>ForPlayerID</code> property.</p>

<p>You can define your own Snapshot, by inheriting from the <code>JUMPCommand_Snapshot</code> class - </p>

<p>See, the [DiceRoller Custom Server] for other examples on wiritng your own custom Snapshots.</p>

<h4>
<a id="jumpplayer" class="anchor" href="#jumpplayer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JUMPPlayer</h4>

<p><code>JUMPPlayer</code> is a simple class used to store basic information like <code>PlayerID</code> and <code>IsConnected</code>.
You can extend the <code>JUMPPlayer</code> with your own properties, like Score for example and keep them in your server state.</p>

<p>See, the [DiceRoller Custom Server] for an example on extendig the <code>JUMPPlayer</code> class.</p>

<h4>
<a id="jumpoptions" class="anchor" href="#jumpoptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JUMPOptions</h4>

<p>You can set a few options with the <code>JUMPOptions</code> class - here are the options with their defaults:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">JUMPOptions</span>
{
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">string</span> GameVersion = <span class="pl-s"><span class="pl-pds">"</span>0.1<span class="pl-pds">"</span></span>;
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">byte</span> NumPlayers = <span class="pl-c1">2</span>;
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">int</span> DisconnectTimeout = <span class="pl-c1">10</span> * <span class="pl-c1">1000</span>;
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">int</span> SnapshotsPerSec = <span class="pl-c1">3</span>;
}</pre></div>

<p>Note that <code>DisconnectTimeout</code> is set to 60 seconds if the build is in Debug mode.</p>

<h1>
<a id="diceroller-sample" class="anchor" href="#diceroller-sample" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DiceRoller Sample</h1>

<p>DiceRoller is a simple example of how to use <strong>JUMP</strong>.
It is made of five scenes, a custom Server Engine and a Game Manager for the play scene.</p>

<h4>
<a id="connection-scene" class="anchor" href="#connection-scene" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Connection Scene</h4>

<p>The Connection Scene has one instance of the <strong>JUMPMultiplayerConnection</strong> <a href="#jumpmultiplayerprefabs">prefab</a> (as a reminder,  this is a behaviour that has a <code>JUMPMultplayer</code> component, with the <code>Stage</code> set as <code>Connection</code>).</p>

<p>The only event handled by the scene the <code>OnMasterDisconnect</code>, in which we load the Master Scene.</p>

<p>The Scene also uses the UI Prefab <strong>JUMPStatusConnection</strong> that displays the status of the connection with Photon.</p>

<h4>
<a id="master-scene" class="anchor" href="#master-scene" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Master Scene</h4>

<p>The Master Scene has has one instance of the <strong>JUMPMultiplayerMaster</strong> prefab.</p>

<p>The scene handles two events:</p>

<ul>
<li>
<code>OnMasterDisconnect</code> that goes back to the Connection Scene to try and reconnect once.</li>
<li>
<code>OnMatchmakeLobbyConnect</code> that loads the Matchmake Lobby Scene</li>
</ul>

<p>The scene uses a few more UI prefabs:</p>

<ul>
<li>
<strong>JUMPStatusOnline</strong> that displays if the client is online (connected with Photon) or offline</li>
<li>
<strong>JUMPStatusDefaultLobby</strong> that displays the number of players connected to the Photon Lobby</li>
<li>
<strong>JUMPButtonMatchmake</strong> a simple text button that is enabled when we are connected to the Photon Master Server; if the user clicks the button, then we invoke the <code>Matchmake</code> operation on the <strong>JUMPMultiplayerMaster</strong> prefab.</li>
</ul>

<h4>
<a id="matchmake-lobby-scene" class="anchor" href="#matchmake-lobby-scene" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Matchmake Lobby Scene</h4>

<p>The Matchmake Lobby Scene has has one instance of the <strong>JUMPMultiplayerMatchmakeLobby</strong> prefab.</p>

<p>The scene handles two events:</p>

<ul>
<li>
<code>OnMatchmakeLobbyDisconnect</code> that goes back to the Master Scene.</li>
<li>
<code>OnGameRoomConnect</code> that loads the Game Room Scene</li>
</ul>

<p>It also sets the <code>GameServerEngineTypeName</code> variable to <code>"DiceRollerSample.DiceRollerEngine"</code> to create a custom server engine - for details see the [DiceRoller Custom Server].</p>

<p>The scene uses a few more UI prefabs:</p>

<ul>
<li>
<strong>JUMPButtonCancelMatchmake</strong> which is enabled during this phase of the UI Flow. If the user clicks the button, then we invoke the <code>CancelMatchmake</code> operation on the <strong>JUMPMultiplayerMatchmakeLobby</strong> prefab.</li>
</ul>

<h4>
<a id="game-room-scene" class="anchor" href="#game-room-scene" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Game Room Scene</h4>

<p>The Game Room Scene has one instance of the <strong>JUMPMultiplayerGameRoom</strong> prefab.</p>

<p>The scene handles two events:</p>

<ul>
<li>
<code>OnGameRoomDisconnect</code> that goes back to the Master Scene.</li>
<li>
<code>OnPlayConnect</code> that loads the Play Scene</li>
</ul>

<p>The scene uses a few more UI prefabs:</p>

<ul>
<li>
<strong>JUMPStatusGameRoom</strong> that displays how many players are in the room.</li>
<li>
<strong>JUMPButtonCancelGameRoom</strong> which is enabled during this phase of the UI Flow. If the user clicks the button, then we invoke the <code>CancelGameRoom</code> operation on the <strong>JUMPMultiplayerGameRoom</strong> prefab.</li>
</ul>

<h4>
<a id="play-scene" class="anchor" href="#play-scene" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Play Scene</h4>

<p>The Game Room Scene has one instance of the <strong>JUMPMultiplayerPlay</strong> prefab.</p>

<p>The scene handles two events:</p>

<ul>
<li>
<code>OnPlayDisconnect</code> that goes back to the Master Scene.</li>
<li>
<code>OnSnapshotReceived</code> that handles the Snapshots form the server via the DiceRollerGameManager - see [DiceRoller Custom Server] for details</li>
</ul>

<p>The scene uses a few more UI prefabs:</p>

<ul>
<li>
<strong>JUMPButtonQuitPlay</strong> hich is enabled during this phase of the UI Flow. If the user clicks the button, then we invoke the <code>QuitPlay</code> operation on the <strong>JUMPMultiplayerPlay</strong> prefab.</li>
</ul>

<h3>
<a id="diceroller-custom-server" class="anchor" href="#diceroller-custom-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DiceRoller Custom Server</h3>

<p>DiceRoller is a simple game, two players roll a dice and try to score the most points in 30 seconds.
To function, DiceRoller needs the Scenes and two additional components:</p>

<ul>
<li>Gustom Server</li>
<li>Game Manager script for the Play Scene</li>
</ul>

<blockquote>
<p>Note: for simplicity of implementation, the action of rolling a dice is non-authoritative: the clients decide the outcome of rolling the dice autonomously; this helps keeping the DiceRoller sample code very straightforward and simple to understand. In your game you might want to have the server take the decisions on the outcome of player actions like this.</p>
</blockquote>

<h4>
<a id="custom-server-1" class="anchor" href="#custom-server-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom Server</h4>

<p>To create a custom server, DiceRoller implements the <a href="#ijumpgameserverengine"><code>IJUMPGameServerEngine</code></a> interface:</p>

<h5>
<a id="dicerollercommand_rolldice" class="anchor" href="#dicerollercommand_rolldice" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DiceRollerCommand_RollDice</h5>

<p>DiceRoller defines a custom command for rolling the dice, this inherits from <code>JUMPCommand</code> and extends it:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">DiceRollerCommand_RollDice</span> : <span class="pl-k">JUMPCommand</span>
{
    <span class="pl-k">public</span> <span class="pl-k">const</span> <span class="pl-k">byte</span> RollDice_EventCode = <span class="pl-c1">100</span>;

    <span class="pl-k">public</span> <span class="pl-k">int</span> PlayerID { get { <span class="pl-en">return</span> (int)CommandData[0]; } <span class="pl-k">set</span> { CommandData[<span class="pl-c1">0</span>] = <span class="pl-k">value</span>; } }
    <span class="pl-k">public</span> <span class="pl-k">int</span> RolledDiceValue { <span class="pl-k">get</span> { <span class="pl-k">return</span> (<span class="pl-k">int</span>)CommandData[<span class="pl-c1">1</span>]; } <span class="pl-k">set</span> { CommandData[<span class="pl-c1">1</span>] = <span class="pl-k">value</span>; } }

    <span class="pl-c">// Create a command to send with this initializer</span>
    <span class="pl-k">public</span> DiceRollerCommand_RollDice(<span class="pl-k">int</span> playerID, <span class="pl-k">int</span> rolledDiceValue) : <span class="pl-c1">base</span>(<span class="pl-k">new</span> <span class="pl-k">object</span>[<span class="pl-c1">2</span>], RollDice_EventCode)
    {
        PlayerID = playerID;
        RolledDiceValue = rolledDiceValue;
    }

    <span class="pl-c">// Create a command when receiving it from Photon</span>
    <span class="pl-k">public</span> DiceRollerCommand_RollDice(<span class="pl-k">object</span>[] data) : <span class="pl-c1">base</span>(data, RollDice_EventCode)
    {
    }
}</pre></div>

<p>Note the definition of the event code: <code>RollDice_EventCode</code>, the use of the standard <code>PlayerID</code> property as the first value in the CommanData array and the definition of two constructors: <code>DiceRollerCommand_RollDice(object[] data)</code> used to create the command from the Photon message and <code>DiceRollerCommand_RollDice(int playerID, int rolledDiceValue)</code> used to send the message.</p>

<h5>
<a id="dicerollerplayer" class="anchor" href="#dicerollerplayer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DiceRollerPlayer</h5>

<p>DiceRoller defines a custom Player to store the game state in <a href="#dicerollergamestate"><code>DiceRollerGameState</code></a>.</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">DiceRollerPlayer</span> : <span class="pl-k">JUMPPlayer</span>
{
    <span class="pl-k">public</span> <span class="pl-k">int</span> Score = <span class="pl-c1">0</span>;
}</pre></div>

<p>Note the inheritance from <code>JUMPPlayer</code> and the addition of the only property that matters in this case, the Score.</p>

<h5>
<a id="dicerollergamestate" class="anchor" href="#dicerollergamestate" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DiceRollerGameState</h5>

<p>DiceRoller custom server defines theits own game state of course - this contains a list of <code>DiceRollerPlayers</code>, the time remaining in the game, the stage of the game (can be waiting for the players, playing or complete) and the time remaining when the game is being played:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">enum</span> <span class="pl-en">DiceRollerGameStages</span>
{
    WaitingForPlayers,
    Playing,
    Complete
}

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">DiceRollerGameState</span>
{
    <span class="pl-k">public</span> Dictionary&lt;<span class="pl-k">int</span>, DiceRollerPlayer&gt; Players = <span class="pl-k">new</span> Dictionary&lt;<span class="pl-k">int</span>, DiceRollerPlayer&gt;();
    <span class="pl-k">public</span> <span class="pl-k">float</span> SecondsRemaining;
    <span class="pl-k">public</span> DiceRollerGameStages Stage;
    <span class="pl-k">public</span> <span class="pl-k">int</span> WinnerPlayerID;
}</pre></div>

<h5>
<a id="diceroller_snapshot" class="anchor" href="#diceroller_snapshot" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DiceRoller_Snapshot</h5>

<p>To communicate the state of the game with the clients, the DiceRoller custom server must define a Snapshot.
The <code>DiceRoller_Snapshot</code> class inherits from <code>JUMPCommand_Snapshot</code> and so can make use of the array of data <code>CommandData</code>, the <code>JUMPSnapshot_EventCode</code> and the <code>ForPlayerID</code> properties already defined in the base class.</p>

<p>All it needs to do is to define two constructors and use the <code>CommandData</code> array to store the Snapshot data.</p>

<p>Note that a Snapshot is different from the GameState because it is aimed to only one of the two players: players should not see each other's data (for example if they have playing cards). </p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">DiceRoller_Snapshot</span> : <span class="pl-k">JUMPCommand_Snapshot</span>
{
    <span class="pl-c">// ForPlayerID is at CommandData[0]</span>
    <span class="pl-k">public</span> <span class="pl-k">int</span> MyScore { get { <span class="pl-en">return</span> (int)CommandData[1]; } <span class="pl-k">set</span> { CommandData[<span class="pl-c1">1</span>] = <span class="pl-k">value</span>; } }
    <span class="pl-k">public</span> <span class="pl-k">int</span> OpponentScore { <span class="pl-k">get</span> { <span class="pl-k">return</span> (<span class="pl-k">int</span>)CommandData[<span class="pl-c1">2</span>]; } <span class="pl-k">set</span> { CommandData[<span class="pl-c1">2</span>] = <span class="pl-k">value</span>; } }
    <span class="pl-k">public</span> <span class="pl-k">float</span> SecondsRemaining { <span class="pl-k">get</span> { <span class="pl-k">return</span> (<span class="pl-k">float</span>)CommandData[<span class="pl-c1">3</span>]; } <span class="pl-k">set</span> { CommandData[<span class="pl-c1">3</span>] = <span class="pl-k">value</span>; } }
    <span class="pl-k">public</span> DiceRollerGameStages Stage { <span class="pl-k">get</span> { <span class="pl-k">return</span> (DiceRollerGameStages)CommandData[<span class="pl-c1">4</span>]; } <span class="pl-k">set</span> { CommandData[<span class="pl-c1">4</span>] = <span class="pl-k">value</span>; } }
    <span class="pl-k">public</span> <span class="pl-k">int</span> WinnerPlayerID { <span class="pl-k">get</span> { <span class="pl-k">return</span> (<span class="pl-k">int</span>)CommandData[<span class="pl-c1">5</span>]; } <span class="pl-k">set</span> { CommandData[<span class="pl-c1">5</span>] = <span class="pl-k">value</span>; } }

    <span class="pl-c">// Create a command to send with this initializer</span>
    <span class="pl-k">public</span> DiceRoller_Snapshot() : <span class="pl-c1">base</span>(<span class="pl-k">new</span> <span class="pl-k">object</span>[<span class="pl-c1">6</span>])
    {
    }

    <span class="pl-c">// Create a command when receiving it from Photon</span>
    <span class="pl-k">public</span> DiceRoller_Snapshot(<span class="pl-k">object</span>[] data) : <span class="pl-c1">base</span>(data)
    {
    }
}</pre></div>

<p>Note how the <code>DiceRoller_Snapshot()</code> constructor creates a new array with 6 elements: one for the <code>ForPlayerID</code> property used by the <code>JUMPCommand_Snapshot</code> base class and five for the custom properties.
Also note how the properties are stored from the second element in the array on, because <code>ForPlayerID</code> is stored at element 0.</p>

<h5>
<a id="dicerollerengine" class="anchor" href="#dicerollerengine" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DiceRollerEngine</h5>

<p>The <code>DiceRollerEngine</code> class implements the <code>IJUMPGameServerEngine</code> interface.</p>

<p>It uses an internal variable to hold the state:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">private</span> DiceRollerGameState GameState;</pre></div>

<p>The constructor simply initializes the state in the waiting for players mode:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> DiceRollerEngine()
{
    GameState = <span class="pl-k">new</span> DiceRollerGameState();
    GameState.Stage = DiceRollerGameStages.WaitingForPlayers;
}</pre></div>

<p>The <code>CommandFromEvent</code> function handles the RollDice custom command:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> JUMPCommand CommandFromEvent(<span class="pl-k">byte</span> eventCode, <span class="pl-k">object</span> content)
{
    <span class="pl-k">if</span> (eventCode == DiceRollerCommand_RollDice.RollDice_EventCode)
    {
        <span class="pl-k">return</span> <span class="pl-k">new</span> DiceRollerCommand_RollDice((<span class="pl-k">object</span>[]) content);
    }
    <span class="pl-k">return</span> <span class="pl-c1">null</span>;
}</pre></div>

<p>The <code>StartGame</code> operation gets the information about the players and sets the state of the game:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">void</span> StartGame(List&lt;JUMPPlayer&gt; Players)
{
    GameState = <span class="pl-k">new</span> DiceRollerGameState();
    GameState.SecondsRemaining = <span class="pl-c1">30</span>;
    GameState.Stage = DiceRollerGameStages.Playing;

    <span class="pl-k">foreach</span> (<span class="pl-k">var</span> pl <span class="pl-k">in</span> Players)
    {
        DiceRollerPlayer player = <span class="pl-k">new</span> DiceRollerPlayer();
        player.PlayerID = pl.PlayerID;
        player.IsConnected = pl.IsConnected;
        player.Score = <span class="pl-c1">0</span>;

        GameState.Players.Add(player.PlayerID, player);
    }
}</pre></div>

<p>The <code>ProcessCommand</code> handles the server state when a client sends a RollDice command (the connect commands are manager automatically by the <code>JUMPGameServer</code> class).</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">void</span> ProcessCommand(JUMPCommand command)
{
    <span class="pl-k">if</span> (command.CommandEventCode == DiceRollerCommand_RollDice.RollDice_EventCode)
    {
        DiceRollerCommand_RollDice rollDiceCommand = command <span class="pl-k">as</span> DiceRollerCommand_RollDice;

        DiceRollerPlayer player;
        <span class="pl-k">if</span> (GameState.Stage == DiceRollerGameStages.Playing)
        {
            <span class="pl-k">if</span> (GameState.Players.TryGetValue(rollDiceCommand.PlayerID, out player))
            {
                player.Score += rollDiceCommand.RolledDiceValue;
            }
        }
    }
}</pre></div>

<p>The <code>Tick</code> operation handles the game clock, when the clock expires, the game state is changed to Coplete and a winner is determined.</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">void</span> Tick(<span class="pl-k">double</span> ElapsedSeconds)
{
    <span class="pl-k">if</span> (GameState.Stage == DiceRollerGameStages.Playing)
    {
        GameState.SecondsRemaining -= (<span class="pl-k">float</span>) ElapsedSeconds;
        <span class="pl-k">if</span> (GameState.SecondsRemaining &lt;= <span class="pl-c1">0</span>)
        {
            <span class="pl-k">int</span> maxscore = <span class="pl-c1">0</span>;
            <span class="pl-k">int</span> winner = -<span class="pl-c1">1</span>;
            <span class="pl-k">foreach</span> (<span class="pl-k">var</span> item <span class="pl-k">in</span> GameState.Players)
            {
                <span class="pl-k">if</span> (item.Value.Score &gt; maxscore)
                {
                    maxscore = item.Value.Score;
                    winner = item.Key; 
                }
            }
            GameState.Stage = DiceRollerGameStages.Complete;
            GameState.WinnerPlayerID = winner;
        }
    }
}</pre></div>

<p>The <code>TakeSnapshot</code> operation is called by <code>JUMPGameServer</code> to send the snapshot to a player, so the snapshot is created for that specific player:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> JUMPCommand_Snapshot TakeSnapshot(<span class="pl-k">int</span> ForPlayerID)
{
    DiceRoller_Snapshot snap = <span class="pl-k">new</span> DiceRoller_Snapshot();
    snap.ForPlayerID = ForPlayerID;
    snap.MyScore = <span class="pl-c1">0</span>;
    snap.OpponentScore = <span class="pl-c1">0</span>;
    <span class="pl-k">foreach</span> (<span class="pl-k">var</span> item <span class="pl-k">in</span> GameState.Players)
    {
        <span class="pl-k">if</span> (item.Value.PlayerID == ForPlayerID)
        {
            snap.MyScore = item.Value.Score;
        }
        <span class="pl-k">else</span>
        {
            snap.OpponentScore = item.Value.Score;
        }
    }
    snap.SecondsRemaining = GameState.SecondsRemaining;
    snap.Stage = GameState.Stage;
    snap.WinnerPlayerID = GameState.WinnerPlayerID;

    <span class="pl-k">return</span> (JUMPCommand_Snapshot) snap;
}</pre></div>

<h4>
<a id="game-manager" class="anchor" href="#game-manager" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Game Manager</h4>

<p>The final piece of <strong>DiceRoller</strong> is the <code>DiceRollerGameManager</code>, this is the Controller part in the MVC pattern: displaying the information in the user interface (View) and working with the <code>Snapshot</code> (Model) received by the <code>JUMPMultiplayer</code> class (see <a href="#play-scene">Play Scene</a>).</p>

<p>'DiceRollerGameManager' is a 'MonoBehaviour' and uses multiple <code>Text</code> and <code>Button</code> controls to display and control the game:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> Text MyScore;
<span class="pl-k">public</span> Text TheirScore;
<span class="pl-k">public</span> Text GameStatus;
<span class="pl-k">public</span> Text TimeLeft;
<span class="pl-k">public</span> Text Result;
<span class="pl-k">public</span> Button RollDice;</pre></div>

<p>When a snapshot is received, the controls are updated:</p>

<div class="highlight highlight-source-cs"><pre>DiceRollerGameStages UIStage = DiceRollerGameStages.WaitingForPlayers;

<span class="pl-k">public</span> <span class="pl-k">void</span> OnSnapshotReceived(JUMPCommand_Snapshot data)
{
    DiceRoller_Snapshot snap = <span class="pl-k">new</span> DiceRoller_Snapshot(data.CommandData);
    GameStatus.text = snap.Stage.ToString();
    MyScore.text = snap.MyScore.ToString();
    TheirScore.text = snap.OpponentScore.ToString();
    TimeLeft.text = snap.SecondsRemaining.ToString(<span class="pl-s"><span class="pl-pds">"</span>0.<span class="pl-pds">"</span></span>);
    UIStage = snap.Stage;
    <span class="pl-k">if</span> (UIStage == DiceRollerGameStages.Complete)
    {
        Result.text = (snap.MyScore &gt; snap.OpponentScore) ? <span class="pl-s"><span class="pl-pds">"</span>You Won :)<span class="pl-pds">"</span></span> : ((snap.MyScore == snap.OpponentScore) ? <span class="pl-s"><span class="pl-pds">"</span>Tied!<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>You Lost :(<span class="pl-pds">"</span></span>);
    }
}</pre></div>

<p>The user can roll a dice, this operation will send the custom command to the server using the <code>JUMPGameClient</code> singleton:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">void</span> RollADice()
{
    <span class="pl-k">int</span> score = UnityEngine.Random.Range(<span class="pl-c1">1</span>, <span class="pl-c1">6</span>);
    <span class="pl-k">if</span> (RollDice != <span class="pl-c1">null</span>)
    {
        RollDice.GetComponent&lt;Text&gt;().text = <span class="pl-s"><span class="pl-pds">"</span>Rolled a <span class="pl-pds">"</span></span> + score + <span class="pl-s"><span class="pl-pds">"</span> <span class="pl-cce">\n</span>roll again..<span class="pl-pds">"</span></span>; 
    }
    Singleton&lt;JUMPGameClient&gt;.Instance.SendCommandToServer(<span class="pl-k">new</span> DiceRollerCommand_RollDice(JUMPMultiplayer.PlayerID, score));
}</pre></div>

<p>Finally, the Unity <code>Start</code> function is used to initialize the random seed and in the <code>Update</code> function we enable the RollDice button only if we are playing:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">// Use this for initialization</span>
<span class="pl-k">void</span> Start () {
    UnityEngine.Random.seed = System.DateTime.Now.Millisecond;
}

<span class="pl-c">// Update is called once per frame</span>
<span class="pl-k">void</span> Update () {
    RollDice.interactable = (UIStage == DiceRollerGameStages.Playing);
}</pre></div>

<h1>
<a id="testing-jump" class="anchor" href="#testing-jump" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Testing JUMP</h1>

<p>Given the fact that Unity does not allow the same project to be opened in two different instances of the Unity Editor and that it can only run one scene at a time, it is very hard to create test automation and to test <strong>JUMP</strong>.
We have done manual testing, but finding a way to automate some of this test would be ideal.
We thought about mocking, but then it would require to mock the behaviour of Photon, making assumptions that might not be matched in the real case and invalidating the tests.</p>

<p>So we worked with manual tests so far, here are the test cases we tried:</p>

<h5>
<a id="start-the-game" class="anchor" href="#start-the-game" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Start the game</h5>

<ul>
<li>Start a Game from the Connection Scene -&gt; the Game should end in the Master  scene with Offline mode on.</li>
<li>Start a Game from any other scene -&gt; the Game should go back to the connection Scene and then end in the Master scene with Offline mode on.</li>
<li>Start a Game with no connection from any Scene -&gt; the Game should end in the Master scene with Offline mode on.</li>
</ul>

<h5>
<a id="disconnect-from-the-game" class="anchor" href="#disconnect-from-the-game" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Disconnect from the game</h5>

<ul>
<li>When on any scene, disconnect the network -&gt; the Game should go back to the connection Scene and then end in the Master  scene with Offline mode on.<br>
</li>
</ul>

<h5>
<a id="matchmake" class="anchor" href="#matchmake" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Matchmake</h5>

<ul>
<li>When on the Master scene, press Matchmake -&gt; the Game should go to the Matchmake screen then the Game should go to the Game Room waiting scene; if there is at least another player in matchmaking, then the game should go to the Play scene.</li>
<li>When on the Matchmake scene if the user press Cancel Matchmaking -&gt; the Game should go back to the main scene; if there is at least another player in matchmaking, then the game should continue on to the Play scene.</li>
</ul>

<h5>
<a id="game-room-waiting" class="anchor" href="#game-room-waiting" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Game Room waiting</h5>

<ul>
<li>When on the Game Room waiting scene, if the user press Cancel -&gt; the game should go back to the Master scene</li>
</ul>

<h5>
<a id="play" class="anchor" href="#play" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Play</h5>

<ul>
<li>When on the Play scene, if the user press Quit -&gt; the game shouls go back to the Master scene</li>
</ul>

<h1>
<a id="features-to-add" class="anchor" href="#features-to-add" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Features to add</h1>

<ul>
<li>Unit test, or at least automation test (with Unity allowing a single window and a single instance this is hard)</li>
<li>Support for bots when there are not enough players online (users in a room by himself for too long)</li>
<li>Improved reliability and speed with delta compression of Snapshots and list of not-acknowledged Commands.</li>
<li>Matchmaking not random but with customizable criteria (SQLLobbies)</li>
<li>Source Code comments on public variables and methods?</li>
</ul>

<hr>

<h1>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h1>

<p>Unless stated otherwise all works are Copyright © 2016 <a href="http://www.juicedteam.com">Juiced Team LLC.</a></p>

<p>And licensed under the <a href="https://raw.githubusercontent.com/MaurGi/JUMP/master/LICENSE.txt">MIT License</a></p>

<h3>
<a id="donate" class="anchor" href="#donate" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Donate</h3>

<p>If you want to donate, you can simply <a href="http://u3d.as/sQw">purchase the JUMP package in the Unity Asset Store</a>.</p>

<h3>
<a id="contribute" class="anchor" href="#contribute" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contribute</h3>

<p>We are not ready to accept pull requests at the time, we are considering that for the future.
If you are interested in contributing, file a bug and we will consider your request.
All contributions will be voluntary and will grant no rights, compensation or license, you will retain the rights to reuse your code.</p>

<h3>
<a id="attribution" class="anchor" href="#attribution" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Attribution</h3>

<p>Photon, Photon Engine, PUN: ©2016 <a href="https://www.photonengine.com">Exit Games</a>® </p>

<p>Unity 3D, Unity Engine: ©2016 <a href="http://unity.com">Unity Technologies</a></p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
